<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>智慧统计</title>
		<link rel="stylesheet" href="layuiadmin/layui/css/layui.css" />
		<link rel="stylesheet" href="layuiadmin/dist/style/admin.css" />
		<link rel="stylesheet" href="layuiadmin/layui/css/public.css" />
		<link rel="stylesheet" href="layuiadmin/layui/css/index.css" />
		<style>
			.layui-card-header{background:url(layuiadmin/layui/images/layui-card-header.jpeg) no-repeat left center;background-size:4px 35px;}
			.layui-card-header h3{font-size:14px;line-height:1.5;}
		</style>
	</head>
	<body>

		<div class="header">
			<header>
				<div class="layui-row">
					<div class="layui-col-xs2 layui-col-sm2">
						<a href="javascript:history.back(-1)" class="layui-btn layui-btn-lg"><i class="layui-icon"></i></a>
					</div>
					<div class="layui-col-xs8 layui-col-sm8">
						<h2>智慧统计</h2>
					</div>
					<div class="layui-col-xs2 layui-col-sm2">
						<a href="javascript:gonext()" class="layui-btn layui-btn-lg"><i class="layui-icon"></i></a>
					</div>
				</div>
			</header>
		</div>

		<div class="layui-container main-wrap">
			<!-- 搜索框 -->
			<div class="search-wrap">
				<form class="layui-form" action="">	
						<input type="text" name="title" id="title" required lay-verify="required" placeholder="请输入指标关键值" autocomplete="off" class="layui-input">
						<button type="submit" name="search" lay-submit lay-filter="*" id="search" class="layui-input"><i class="layui-icon layui-icon-search"></i>
						</button>
					</from>
			</div>
			<!-- 热搜 -->
			<div class="hot-search-wrap layui-row layui-anim layui-anim-upbit">
				<div class="layui-col-xs1"><strong>热搜</strong></div>
				<div class="layui-col-xs11">
					<p class="hot-search"></p>
				</div>
			</div>
			<!-- 轮播图 -->
			<div class="layui-carousel" id="test1">
				<div carousel-item></div>
			</div>
			<div class="main-body">
				<!-- 选项卡tabs切换 -->
				<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
					<ul class="layui-tab-title layui-row">
						<li class="layui-this layui-col-xs6">推荐</li>
						<li class="layui-col-xs6">关注</li>
					</ul>
					<div class="layui-tab-content">
						<div class="layui-tab-item layui-show layui-anim layui-anim-upbit">
							<ul class="layui-card-list" id="recommend"></ul>
						</div>
						<div class="layui-tab-item layui-anim layui-anim-upbit">

							<ul class="layui-card-list" id="follow"></ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="copyright">
			Copyright &copy; 2019 中国移动通信集团有限公司研究院
		</div>
		<div class="footer">
			<footer>
				<ul>
					<li class="active">
						<a href="index.html"><i class="footer-bg1">&nbsp;</i></br>首页</a>
					</li>
					<li>
						<a href="quota.html"><i class="footer-bg2">&nbsp;</i></br>指标</a>
					</li>
					<li>
						<a href="special.html"><i class="footer-bg3">&nbsp;</i></br>专题</a>
					</li>
					<li>
						<a href="report.html"><i class="footer-bg4">&nbsp;</i></br>报告</a>
					</li>
					<li>
						<a href="user.html"><i class="footer-bg5">&nbsp;</i></br>我的</a>
					</li>
				</ul>
			</footer>
		</div>
		<script src="layuiadmin/layui/layui.js"></script>
		<script src="layuiadmin/layui/js/watermark.js"></script>
		<script>
			watermark({
				watermark_txt: "18663105621"
			}) //传入动态水印内容

			function gonext() {
				window.history.forward() //返回下一页

			}
			layui.use(['jquery', 'form', 'carousel', 'element'], function() {
				var $ = layui.$
				var form = layui.form; //搜索框
				form.on('submit(*)', function(data) {
					console.log(data.elem) //被执行事件的元素DOM对象，一般为button对象
					console.log(data.form) //被执行提交的form对象，一般在存在form标签时才会返回
					console.log(data.field) //当前容器的全部表单字段，名值对形式：{name: value}
					return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
				});
				//屏幕滚动 触发热搜
				$(window).scroll(function() {
					if ($(window).scrollTop() > 10) {
						$(".hot-search-wrap").show();
					}
				});
				//热搜
				$.ajax({
					type: "get",
					async: true, //异步请求
					url: "https://www.easy-mock.com/mock/5c6e22c28ef35e1f80e352ab/Intelligence_statistics/hot-search",
					data: {},
					dataType: "json", //返回数据形式为json
					success: function(data) {
						$(".hot-search").html("");
						let hot_search = "";
						$.each(data.list, function(i) {
							hot_search += `<span class="layui-badge">${data.list[i].name}</span>`
						})
						$(".hot-search").html(hot_search);
						$(".hot-search span").each(function() {
							$(this).click(function() {
								var key_word = $(this).html()
								$("#title").val(key_word)
							})
						})
					},
					error: function() {
						//请求失败时执行该函数
						layer.alert("请求数据失败!");
					}
				});

				//选项卡tabs切换
				var element = layui.element;
				//一些事件监听
				element.on('tab(demo)', function(data) {
					console.log(data);
				});
				var carousel = layui.carousel; //轮播图
				//建造实例
				var options = {
					elem: '#test1',
					width: '100%', //设置容器宽度
					height: 165, //设置容高度
					arrow: 'none', //始终不显示箭头
					autoplay: true, //自动播放
					anim: 'fade', //切换动画方式
					interval: 3000, //自动切换的时间间隔，单位：ms（毫秒），不能低于800
				}
				carousel.render(options)
				$.ajax({
					type: "get",
					async: true, //异步请求
					url: "https://www.easy-mock.com/mock/5c6e22c28ef35e1f80e352ab/Intelligence_statistics/rotation",
					data: {},
					dataType: "json", //返回数据形式为json
					success: function(data) {
						$(".layui-carousel div").html("");
						let layui_carousel = "";
						for (let i = 0; i < data.list.length; i++) {
							layui_carousel +=
								`<div class="rotation_wrap">
									<dl>
										<dt class="layui-row">
											<h1 class="layui-col-xs4">${data.list[i].num}</h1>
											<div class="layui-col-xs3">
												<span>指标值</span><p>单位:${data.list[i].company}</p>
											</div>
											<div class="layui-col-xs5">
												<img src="layuiadmin/layui/images/rotation_wrap_bg.png" />
											</div>
							
										</dt>
										<dd>[${data.list[i].title} ${data.list[i].date}]</dd>
									</dl>
									<ul>
										<li>${data.list[i].num1}</br>${data.list[i].title1}</li>
										<li>${toPercent(data.list[i].num2)}</br>${data.list[i].title2}</li>
										<li>${toPercent(data.list[i].num3)}</br>${data.list[i].title3}</li>
										<li>${data.list[i].num4}</br>${data.list[i].title4}</li>
										<li>${data.list[i].num5}</br>${data.list[i].title5}</li>
									</ul>
								</div>`
						}

						function toPercent(point) {
							let str = Number(point * 100).toFixed(2);
							str += "%";
							return str;
						}
						$(".layui-carousel div").html(layui_carousel);
						//重置轮播
						var ins = carousel.render(options);
						ins.reload();
					}
				})

				//推荐指标
				$.ajax({
					type: "get",
					async: true, //异步请求
					url: "https://www.easy-mock.com/mock/5c6e22c28ef35e1f80e352ab/Intelligence_statistics/index",
					data: {},
					dataType: "json", //返回数据形式为json
					success: function(data) {
						console.log(data)
						$("#recommend").html("");
						let recommend = "";
						for (let i = 0; i < data.list.length; i++) {
							recommend +=
								`<li class="layui-card">
						<div class="layui-card-header layui-row">
						  <div class="layui-col-xs9 layui-card-header-left">
							<h3>${data.list[i].name}</h3>
							<h4>单位:${data.list[i].company}</h4>
						  </div>
						</div>
						<div class="layui-card-body layui-row">
							<ul class="quota-list">
								<li>${data.list[i].target}</br>指标值</li>
								<li>${data.list[i].cptarget}</br>当期指标值</li>
								<li>${toPercent(data.list[i].chainratio)}</br>环比</li>
								<li>${toPercent(data.list[i].yoy)}</br>同比</li>
								<li>${data.list[i].year}</br>本年累计数</li>
								<li>${data.list[i].last}</br>去年同期累计</li>
							</ul>
						</div>
					</li>`
						}

						function toPercent(point) {
							let str = Number(point * 100).toFixed(2);
							str += "%";
							return str;
						}
						$("#recommend").html(recommend);
						$(".quota-list li").click(function() {
							window.location.href = "issue.html";
						});
					},
					error: function() {
						//请求失败时执行该函数
						layer.alert("请求数据失败!");

					}
				});

				//关注指标
				$.ajax({
					type: "get",
					async: true, //异步请求
					url: "https://www.easy-mock.com/mock/5c6e22c28ef35e1f80e352ab/Intelligence_statistics/index",
					data: {},
					dataType: "json", //返回数据形式为json
					success: function(data) {
						console.log(data)
						$("#follow").html("");
						let follow = "";
						for (let i = 0; i < data.list.length; i++) {
							follow +=
								`<li class="layui-card">
						<div class="layui-card-header layui-row">
						  <div class="layui-col-xs9 layui-card-header-left">
							<h3>${data.list[i].name}</h3>
							<h4>单位:${data.list[i].company}</h4>
						  </div>
						  <div class="layui-col-xs3 layui-card-header-right"><i class="layui-icon layui-icon-star-fill"></i>&nbsp;已关注</div>
						</div>
						<div class="layui-card-body layui-row">
							<ul class="quota-list">
								<li>${data.list[i].target}</br>指标值</li>
								<li>${data.list[i].cptarget}</br>当期指标值</li>
								<li>${toPercent(data.list[i].chainratio)}</br>环比</li>
								<li>${toPercent(data.list[i].yoy)}</br>同比</li>
								<li>${data.list[i].year}</br>本年累计数</li>
								<li>${data.list[i].last}</br>去年同期累计</li>
							</ul>
						</div>
					</li>`
						}

						function toPercent(point) {
							let str = Number(point * 100).toFixed(2);
							str += "%";
							return str;
						}

						$("#follow").html(follow);

						$(".quota-list li").click(function() {

							window.location.href = "issue.html";
						});

						//关注与取消关注 
						$(".layui-card-header-right").click(function() {
							if ($(this).children().hasClass("layui-icon-star")) {
								$(this).html(` <i class="layui-icon layui-icon-star-fill"></i>&nbsp;已关注`)
							} else {
								$(this).parent().parent().slideUp(500, function() {
									$(this).remove();
								});
							}
						})
					},
					error: function() {
						//请求失败时执行该函数
						layer.alert("请求数据失败!");

					}
				});

			});
		</script>
	</body>
</html>
